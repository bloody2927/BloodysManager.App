<Window x:Class="BloodysManager.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:BloodysManager.App.Views.Converters"
        Title="Bloody's Manager"
        MinWidth="960"
        MinHeight="640"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <conv:BoolToBrushConverter x:Key="BoolToBrush" />
    </Window.Resources>

    <DockPanel LastChildFill="True">
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="Save Configuration" Command="{Binding CmdSaveConfig}" />
                <Separator />
                <MenuItem Header="Exit" Command="{Binding CmdExit}" />
            </MenuItem>
            <MenuItem Header="Settings" Command="{Binding CmdOpenSettings}" />
            <MenuItem Header="Credits" Command="{Binding CmdOpenCredits}" />
        </Menu>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24" HorizontalAlignment="Stretch">
                <TextBlock Text="{Binding AppTitle}"
                           FontSize="32"
                           FontWeight="Bold"
                           HorizontalAlignment="Center" />

                <GroupBox Header="Repository" Margin="10">
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="600"
                                 Text="{Binding RepositoryUrl, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Git repository URL (e.g. https://github.com/azerothcore/azerothcore-wotlk.git)"/>
                        <Button Content="Save" Margin="8,0,0,0" Command="{Binding CmdSaveConfig}"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="Download Target" Margin="10,0,10,10">
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="600"
                                 Text="{Binding DownloadPath, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Target folder for clean clone"/>
                        <Button Content="..." Width="34" Margin="8,0,0,0" Command="{Binding CmdBrowseDownloadPath}"
                                ToolTip="Browse for download target"/>
                        <Button Content="Save" Margin="8,0,0,0" Command="{Binding CmdSaveConfig}"/>
                    </StackPanel>
                </GroupBox>

                <Border Style="{StaticResource CardBorderStyle}">
                    <StackPanel>
                        <DockPanel>
                            <TextBlock Text="Servers"
                                       Style="{StaticResource SectionHeaderTextStyle}"
                                       DockPanel.Dock="Left" />
                            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                                <Button Content="New" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding CmdAddProfile}" />
                                <Button Content="Create Structure" Style="{StaticResource SecondaryButtonStyle}" Command="{Binding CmdCreateFolders}" Margin="8,0,0,0" />
                            </StackPanel>
                        </DockPanel>

                        <Grid Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="220" />
                                <ColumnDefinition Width="16" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <ListBox ItemsSource="{Binding Profiles}"
                                     SelectedItem="{Binding SelectedProfile}"
                                     BorderThickness="0"
                                     MinHeight="160">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <DockPanel>
                                            <Button Content="Ã—"
                                                    Width="24"
                                                    Height="24"
                                                    Margin="0,0,6,0"
                                                    Command="{Binding DataContext.CmdRemoveProfile, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource SecondaryButtonStyle}" />
                                            <TextBlock Text="{Binding Name}" VerticalAlignment="Center" />
                                        </DockPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <Border Grid.Column="2" BorderBrush="#FFE0E0E0" BorderThickness="1" CornerRadius="8" Padding="12" Background="White">
                                <StackPanel>
                                    <TextBlock Text="{Binding SelectedProfile.Name, FallbackValue=No server selected}" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,8" />

                                    <Grid Margin="0,4,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Style="{StaticResource StatusDotStyle}" Fill="{Binding ExistsLive, Converter={StaticResource BoolToBrush}}" />
                                        <TextBlock Grid.Column="1" Text="Live" VerticalAlignment="Center" Margin="0,0,8,0" />
                                        <TextBox Grid.Column="2" Style="{StaticResource PathTextBoxStyle}" Text="{Binding SelectedProfile.PathLive, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Grid.Column="3" Content="..." Width="32" Command="{Binding CmdSetPathLive}" />
                                    </Grid>

                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Style="{StaticResource StatusDotStyle}" Fill="{Binding ExistsCopy, Converter={StaticResource BoolToBrush}}" />
                                        <TextBlock Grid.Column="1" Text="Copy" VerticalAlignment="Center" Margin="0,0,8,0" />
                                        <TextBox Grid.Column="2" Style="{StaticResource PathTextBoxStyle}" Text="{Binding SelectedProfile.PathCopy, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Grid.Column="3" Content="..." Width="32" Command="{Binding CmdSetPathCopy}" />
                                    </Grid>

                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Style="{StaticResource StatusDotStyle}" Fill="{Binding ExistsBackup, Converter={StaticResource BoolToBrush}}" />
                                        <TextBlock Grid.Column="1" Text="Backup" VerticalAlignment="Center" Margin="0,0,8,0" />
                                        <TextBox Grid.Column="2" Style="{StaticResource PathTextBoxStyle}" Text="{Binding SelectedProfile.PathBackup, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Grid.Column="3" Content="..." Width="32" Command="{Binding CmdSetPathBackup}" />
                                    </Grid>

                                    <Grid Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Style="{StaticResource StatusDotStyle}" Fill="{Binding ExistsBackupZip, Converter={StaticResource BoolToBrush}}" />
                                        <TextBlock Grid.Column="1" Text="Backup Zip" VerticalAlignment="Center" Margin="0,0,8,0" />
                                        <TextBox Grid.Column="2" Style="{StaticResource PathTextBoxStyle}" Text="{Binding SelectedProfile.PathBackupZip, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Grid.Column="3" Content="..." Width="32" Command="{Binding CmdSetPathBackupZip}" />
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Border>

                <UniformGrid Columns="4" Margin="0,8,0,0">
                    <Button Content="Download"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentOrange}"
                            Command="{Binding CmdDownload}"
                            ToolTip="Clean clone repository into the configured DownloadPath" />
                    <Button Content="Update"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentOrange}"
                            Command="{Binding CmdUpdate}" />
                    <Button Content="Live â†’ Copy"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentGreen}"
                            Command="{Binding CmdCopy}" />
                    <Button Content="Delete Live"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentRed}"
                            Command="{Binding CmdDeleteLive}" />
                </UniformGrid>

                <UniformGrid Columns="3" Margin="0,8,0,0">
                    <Button Content="Delete Copy"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentRed}"
                            Command="{Binding CmdDeleteCopy}" />
                    <Button Content="Rotate Backup"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentGold}"
                            Command="{Binding CmdRotate}" />
                    <Button Content="Exit"
                            Style="{StaticResource RoundedActionButtonStyle}"
                            Background="{StaticResource AccentGold}"
                            Command="{Binding CmdExit}" />
                </UniformGrid>

                <Border Style="{StaticResource CardBorderStyle}" Margin="0,8,0,0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                            <TextBlock Text="Status:" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding IsBusy}" Margin="8,0,0,0" />
                        </StackPanel>
                        <TextBlock Text="Log" Margin="0,8,0,4" FontWeight="SemiBold" />
                        <Border BorderBrush="#FFCCCCCC" BorderThickness="1" CornerRadius="6">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Height="200">
                                <TextBox Text="{Binding Log}"
                                         IsReadOnly="True"
                                         TextWrapping="Wrap"
                                         FontFamily="Consolas"
                                         FontSize="12"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         AcceptsReturn="True" />
                            </ScrollViewer>
                        </Border>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>
